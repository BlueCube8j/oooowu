-- –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Å–∫—Ä–∏–ø—Ç –±–æ—Ç–∞ –¥–ª—è Roblox
local Players = game:GetService("Players")
local RunService = game:GetService("RunService")

local OWNER_NAME = "flyffyx1"
local BOT_NAME = "FireBybsa"

local CommandSystem = {ActiveEffects = {}}

function CommandSystem:stopAllEffects()
    for _, v in pairs(self.ActiveEffects) do v:Disconnect() end
    self.ActiveEffects = {}
end

function CommandSystem:getDistance(p1, p2)
    if not p1.Character or not p2.Character then return 999 end
    local h1, h2 = p1.Character:FindFirstChild("HumanoidRootPart"), p2.Character:FindFirstChild("HumanoidRootPart")
    return h1 and h2 and (h1.Position - h2.Position).Magnitude or 999
end

function CommandSystem:setSpeed(speed)
    local bot = Players:FindFirstChild(BOT_NAME)
    if not bot or not bot.Character then return false end
    local hum = bot.Character:FindFirstChildOfClass("Humanoid")
    if hum then
        hum.WalkSpeed = tonumber(speed) or 16
        self:sendMessage("Speed set to " .. (tonumber(speed) or 16))
        return true
    end
    return false
end

function CommandSystem:sendMessage(msg)
    pcall(function()
        game:GetService("TextChatService").TextChannels.RBXGeneral:SendAsync("[BOT] " .. msg)
    end)
end

function CommandSystem:flingTarget(targetPlayer)
    if not targetPlayer or not targetPlayer.Character then return false end
    
    local targetHRP = targetPlayer.Character:FindFirstChild("HumanoidRootPart")
    if not targetHRP then return false end

    targetHRP.Velocity = Vector3.new(math.random(-50000, 50000), 100000, math.random(-50000, 50000))
    task.wait(0.1)
    targetHRP.CFrame = CFrame.new(0, 100000, 0)
    
    return true
end

function CommandSystem:startFollow(targetName)
    local bot = Players:FindFirstChild(BOT_NAME)
    local target = Players:FindFirstChild(targetName)
    if not bot or not bot.Character or not target or not target.Character then return false end

    self:stopAllEffects()
    
    local lastPosChange = 0
    local currentOffset = Vector3.new(2, 0, 2)
    
    local conn = RunService.Heartbeat:Connect(function()
        if not bot.Character or not target.Character then conn:Disconnect() return end
        
        local bHRP = bot.Character:FindFirstChild("HumanoidRootPart")
        local tHRP = target.Character:FindFirstChild("HumanoidRootPart")
        local bHum = bot.Character:FindFirstChildOfClass("Humanoid")
        
        if not bHRP or not tHRP or not bHum then return end
        
        if tick() - lastPosChange > math.random(5, 6) then
            lastPosChange = tick()
            currentOffset = Vector3.new(math.random(-3, 3), 0, math.random(-3, 3))
        end
        
        if (tHRP.Position - bHRP.Position).Magnitude > 5 then
            bHum:MoveTo(tHRP.Position + currentOffset)
        end
    end)
    
    self.ActiveEffects["follow"] = conn
    return true
end

function CommandSystem:startHeadsit(targetName)
    local bot = Players:FindFirstChild(BOT_NAME)
    local target = Players:FindFirstChild(targetName)
    if not bot or not bot.Character or not target or not target.Character then return false end

    self:stopAllEffects()
    
    local hum = bot.Character:FindFirstChildOfClass("Humanoid")
    if hum then hum.Sit = true end
    
    local conn = RunService.Heartbeat:Connect(function()
        if not bot.Character or not target.Character then conn:Disconnect() return end
        
        local bHRP = bot.Character:FindFirstChild("HumanoidRootPart")
        local tHRP = target.Character:FindFirstChild("HumanoidRootPart")
        if not bHRP or not tHRP then return end
        
        bHRP.CFrame = CFrame.new(tHRP.Position + Vector3.new(0, 4, 0))
    end)
    
    self.ActiveEffects["headsit"] = conn
    return true
end

function CommandSystem:startCarpet(targetName)
    local bot = Players:FindFirstChild(BOT_NAME)
    local target = Players:FindFirstChild(targetName)
    if not bot or not bot.Character or not target or not target.Character then return false end

    self:stopAllEffects()
    
    local conn = RunService.Heartbeat:Connect(function()
        if not bot.Character or not target.Character then conn:Disconnect() return end
        
        local bHRP = bot.Character:FindFirstChild("HumanoidRootPart")
        local tHRP = target.Character:FindFirstChild("HumanoidRootPart")
        if not bHRP or not tHRP then return end
        
        bHRP.CFrame = CFrame.new(tHRP.Position - Vector3.new(0, 3, 0))
    end)
    
    self.ActiveEffects["carpet"] = conn
    return true
end

function CommandSystem:startFling(targetName)
    local bot = Players:FindFirstChild(BOT_NAME)
    local target = Players:FindFirstChild(targetName)
    if not bot or not bot.Character or not target or not target.Character then return false end

    if self:getDistance(bot, target) > 200 then return false end

    self:stopAllEffects()
    
    local conn = RunService.Heartbeat:Connect(function()
        if not bot.Character or not target.Character then conn:Disconnect() return end
        
        local bHRP = bot.Character:FindFirstChild("HumanoidRootPart")
        local tHRP = target.Character:FindFirstChild("HumanoidRootPart")
        local bHum = bot.Character:FindFirstChildOfClass("Humanoid")
        
        if not bHRP or not tHRP or not bHum then return end
        
        if self:getDistance(bot, target) <= 40 then
            self:flingTarget(target)
        else
            bHum:MoveTo(tHRP.Position)
        end
    end)
    
    self.ActiveEffects["fling"] = conn
    return true
end

function CommandSystem:startDance(targetName)
    local bot = Players:FindFirstChild(BOT_NAME)
    local target = Players:FindFirstChild(targetName)
    if not bot or not bot.Character or not target or not target.Character then return false end

    self:stopAllEffects()
    
    local angle = 0
    local conn = RunService.Heartbeat:Connect(function()
        if not bot.Character or not target.Character then conn:Disconnect() return end
        
        local bHRP = bot.Character:FindFirstChild("HumanoidRootPart")
        local tHRP = target.Character:FindFirstChild("HumanoidRootPart")
        if not bHRP or not tHRP then return end
        
        angle = angle + 0.1
        bHRP.CFrame = CFrame.new(tHRP.Position + Vector3.new(3, 0, 3)) * CFrame.Angles(0, angle, 0)
    end)
    
    self.ActiveEffects["dance"] = conn
    return true
end

function CommandSystem:sendLike(targetName)
    local target = Players:FindFirstChild(targetName)
    if not target then return false end

    if self:getDistance(Players:FindFirstChild(BOT_NAME), target) > 100 then
        self:sendMessage("too far!")
        return false
    end

    local compliments = {"hey! you got awesome skinüòÅ", "hii, you look good!", "I almost fainted, when I saw your skinüòç", "wow, amazing avatar!", "you're looking great today!"}
    self:sendMessage(compliments[math.random(1, #compliments)])
    return true
end

function CommandSystem:startBang(targetName)
    local bot = Players:FindFirstChild(BOT_NAME)
    local target = Players:FindFirstChild(targetName)
    if not bot or not bot.Character or not target or not target.Character then return false end

    self:stopAllEffects()
    
    local conn = RunService.Heartbeat:Connect(function()
        if not bot.Character or not target.Character then conn:Disconnect() return end
        
        local bHRP = bot.Character:FindFirstChild("HumanoidRootPart")
        local tHRP = target.Character:FindFirstChild("HumanoidRootPart")
        if not bHRP or not tHRP then return end
        
        bHRP.CFrame = CFrame.new(tHRP.Position - tHRP.CFrame.LookVector * 3) * CFrame.Angles(0, math.pi, 0)
    end)
    
    self.ActiveEffects["bang"] = conn
    return true
end

function CommandSystem:startSpin(speed)
    local bot = Players:FindFirstChild(BOT_NAME)
    if not bot or not bot.Character then return false end
    
    local bHRP = bot.Character:FindFirstChild("HumanoidRootPart")
    if not bHRP then return false end
    
    self:stopAllEffects()
    
    local angle = 0
    local spd = tonumber(speed) or 30
    local conn = RunService.Heartbeat:Connect(function()
        if not bot.Character or not bHRP then conn:Disconnect() return end
        angle = angle + spd * 0.1
        bHRP.CFrame = bHRP.CFrame * CFrame.Angles(0, math.rad(angle), 0)
    end)
    
    self.ActiveEffects["spin"] = conn
    return true
end

function CommandSystem:startJump()
    local bot = Players:FindFirstChild(BOT_NAME)
    if not bot or not bot.Character then return false end
    
    local hum = bot.Character:FindFirstChildOfClass("Humanoid")
    if not hum then return false end
    
    self:stopAllEffects()
    
    local lastJump = 0
    local conn = RunService.Heartbeat:Connect(function()
        if not bot.Character or not hum then conn:Disconnect() return end
        if tick() - lastJump > 2 then
            lastJump = tick()
            hum.Jump = true
        end
    end)
    
    self.ActiveEffects["jump"] = conn
    return true
end

function CommandSystem:startGoto(targetName)
    local bot = Players:FindFirstChild(BOT_NAME)
    local target = Players:FindFirstChild(targetName)
    if not bot or not bot.Character or not target or not target.Character then return false end
    
    local bHRP = bot.Character:FindFirstChild("HumanoidRootPart")
    local tHRP = target.Character:FindFirstChild("HumanoidRootPart")
    if not bHRP or not tHRP then return false end
    
    bHRP.CFrame = tHRP.CFrame + Vector3.new(3, 0, 3)
    return true
end

function CommandSystem:startOrbit(targetName, speed)
    local bot = Players:FindFirstChild(BOT_NAME)
    local target = Players:FindFirstChild(targetName)
    if not bot or not bot.Character or not target or not target.Character then return false end
    
    self:stopAllEffects()
    
    local angle = 0
    local spd = tonumber(speed) or 20
    local conn = RunService.Heartbeat:Connect(function(dt)
        if not bot.Character or not target.Character then conn:Disconnect() return end
        
        local bHRP = bot.Character:FindFirstChild("HumanoidRootPart")
        local tHRP = target.Character:FindFirstChild("HumanoidRootPart")
        if not bHRP or not tHRP then return end
        
        angle = angle + spd * dt * 2
        local x, z = math.cos(angle) * 5, math.sin(angle) * 5
        local orbitPos = tHRP.Position + Vector3.new(x, 2, z)
        
        bHRP.CFrame = CFrame.lookAt(orbitPos, tHRP.Position)
    end)
    
    self.ActiveEffects["orbit"] = conn
    return true
end

function CommandSystem:sendFriendRequest(targetName)
    self:sendMessage("Sent friend request to " .. targetName)
    return true
end

function CommandSystem:startLook(targetName)
    local bot = Players:FindFirstChild(BOT_NAME)
    local target = Players:FindFirstChild(targetName)
    if not bot or not bot.Character or not target or not target.Character then return false end

    self:stopAllEffects()
    
    local conn = RunService.Heartbeat:Connect(function()
        if not bot.Character or not target.Character then conn:Disconnect() return end
        
        local bHRP = bot.Character:FindFirstChild("HumanoidRootPart")
        local tHRP = target.Character:FindFirstChild("HumanoidRootPart")
        if not bHRP or not tHRP then return end
        
        local lookAt = tHRP.Position
        bHRP.CFrame = CFrame.lookAt(bHRP.Position, Vector3.new(lookAt.X, bHRP.Position.Y, lookAt.Z))
    end)
    
    self.ActiveEffects["look"] = conn
    return true
end

function CommandSystem:resetBot()
    local bot = Players:FindFirstChild(BOT_NAME)
    if not bot then return false end
    
    self:stopAllEffects()
    if bot.Character then bot.Character:BreakJoints() end
    return true
end

function CommandSystem:startWave(targetName)
    local bot = Players:FindFirstChild(BOT_NAME)
    local target = Players:FindFirstChild(targetName)
    if not bot or not bot.Character or not target or not target.Character then return false end

    if self:getDistance(bot, target) > 100 then return false end

    self:stopAllEffects()
    
    local bHRP = bot.Character:FindFirstChild("HumanoidRootPart")
    local tHRP = target.Character:FindFirstChild("HumanoidRootPart")
    if bHRP and tHRP then bHRP.CFrame = tHRP.CFrame + Vector3.new(5, 0, 5) end
    
    self:sendMessage("üëã Hello " .. targetName .. "!")
    return true
end

function CommandSystem:startGuard(targetName)
    local bot = Players:FindFirstChild(BOT_NAME)
    local target = Players:FindFirstChild(targetName)
    if not bot or not bot.Character or not target or not target.Character then return false end

    self:stopAllEffects()
    
    local botHum = bot.Character:FindFirstChildOfClass("Humanoid")
    if botHum then botHum.WalkSpeed = 23 end
    
    local lastAction, lastPosChange = 0, 0
    local guardOffset = Vector3.new(7, 0, 0)
    
    local conn = RunService.Heartbeat:Connect(function()
        if not bot.Character or not target.Character then conn:Disconnect() return end
        
        local bHRP = bot.Character:FindFirstChild("HumanoidRootPart")
        local tHRP = target.Character:FindFirstChild("HumanoidRootPart")
        local bHum = bot.Character:FindFirstChildOfClass("Humanoid")
        if not bHRP or not tHRP or not bHum then return end
        
        if tick() - lastPosChange > 5 then
            lastPosChange = tick()
            local angle = math.random() * math.pi * 2
            guardOffset = Vector3.new(math.cos(angle) * 7, 0, math.sin(angle) * 7)
        end
        
        bHum:MoveTo(tHRP.Position + guardOffset)
        
        for _, player in pairs(Players:GetPlayers()) do
            if player ~= target and player ~= bot and player.Character then
                local pHRP = player.Character:FindFirstChild("HumanoidRootPart")
                if pHRP then
                    local distToTarget = (pHRP.Position - tHRP.Position).Magnitude
                    local distToBot = (pHRP.Position - bHRP.Position).Magnitude
                    
                    if distToTarget <= 15 or distToBot < 10 then
                        bHum:MoveTo(pHRP.Position)
                        self:flingTarget(player)
                        break
                    end
                end
            end
        end
        
        if tick() - lastAction > 3 then
            lastAction = tick()
            if math.random(1, 3) == 1 then
                bHRP.CFrame = bHRP.CFrame * CFrame.Angles(0, math.rad(90), 0)
            elseif math.random(1, 3) == 2 then
                bHum.Jump = true
            end
        end
    end)
    
    self.ActiveEffects["guard"] = conn
    return true
end

function CommandSystem:showCommands()
    local cmds = [[[BOT] –ö–æ–º–∞–Ω–¥—ã:
.follow .headsit .carpet .fling
.dance .like .bang .spin .jump  
.goto .orbit .invite .look .reset
.wave .guard .speed .stop .cmds]]
    self:sendMessage(cmds)
end

function CommandSystem:processCommand(owner, msg)
    if owner.Name ~= OWNER_NAME then return end
    
    local args = {}
    for word in msg:gmatch("%S+") do table.insert(args, word:lower()) end
    if #args == 0 then return end
    
    local cmd = args[1]
    
    if cmd == ".follow" and args[2] then self:startFollow(args[2])
    elseif cmd == ".headsit" and args[2] then self:startHeadsit(args[2])
    elseif cmd == ".carpet" and args[2] then self:startCarpet(args[2])
    elseif cmd == ".fling" and args[2] then if not self:startFling(args[2]) then self:sendMessage("too far!") end
    elseif cmd == ".dance" and args[2] then self:startDance(args[2])
    elseif cmd == ".like" and args[2] then self:sendLike(args[2])
    elseif cmd == ".bang" and args[2] then self:startBang(args[2])
    elseif cmd == ".spin" then self:startSpin(args[2])
    elseif cmd == ".jump" then self:startJump()
    elseif cmd == ".goto" and args[2] then self:startGoto(args[2])
    elseif cmd == ".orbit" and args[2] then self:startOrbit(args[2], args[3])
    elseif cmd == ".invite" and args[2] then self:sendFriendRequest(args[2])
    elseif cmd == ".look" and args[2] then self:startLook(args[2])
    elseif cmd == ".reset" then self:resetBot()
    elseif cmd == ".wave" and args[2] then if not self:startWave(args[2]) then self:sendMessage("too far!") end
    elseif cmd == ".guard" and args[2] then self:startGuard(args[2])
    elseif cmd == ".speed" and args[2] then self:setSpeed(args[2])
    elseif cmd == ".stop" then 
        self:stopAllEffects()
        local bot = Players:FindFirstChild(BOT_NAME)
        if bot and bot.Character then
            local hum = bot.Character:FindFirstChildOfClass("Humanoid")
            if hum then hum.WalkSpeed = 16 end
        end
        self:sendMessage("stopped all actions")
    elseif cmd == ".cmds" then self:showCommands() end
end

function CommandSystem:init()
    for _, player in pairs(Players:GetPlayers()) do
        player.Chatted:Connect(function(msg) self:processCommand(player, msg) end)
    end
    Players.PlayerAdded:Connect(function(player)
        player.Chatted:Connect(function(msg) self:processCommand(player, msg) end)
    end)
    
    print("–ë–æ—Ç –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω! –í–ª–∞–¥–µ–ª–µ—Ü: " .. OWNER_NAME)
    print("–ë–æ—Ç: " .. BOT_NAME)
end

CommandSystem:init()
